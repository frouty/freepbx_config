
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>DAHDI Config &#8212; Freenas Doc v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="dahdi-config">
<h1>DAHDI Config<a class="headerlink" href="#dahdi-config" title="Permalink to this headline">¶</a></h1>
<p>Dans ce mdule DAHDI Config on configure les port FXO</p>
<p><a class="reference external" href="http://wiki.freepbx.org/display/FPG/DAHDI+Configs">http://wiki.freepbx.org/display/FPG/DAHDI+Configs</a></p>
<p><a class="reference external" href="http://documentation.xivo.io/en/stable/administration/hardware/hardware.html">http://documentation.xivo.io/en/stable/administration/hardware/hardware.html</a></p>
<p><a class="reference external" href="http://www.voip-info.org/wiki/view/DAHDI">http://www.voip-info.org/wiki/view/DAHDI</a></p>
<p>J’ai une carte avec 4 ports FXO sur l’appliance sangoma pour y brancher les cables analogiques de l’OPT.</p>
<p>cat /proc/dahdi
dahdi_hardware
asterisk -rvd</p>
<section id="dahdi-configs-module">
<h2>DAHDI Configs module<a class="headerlink" href="#dahdi-configs-module" title="Permalink to this headline">¶</a></h2>
<p>Permet de configurer les DAHDI PSTN card (analog, T1/E1/PRI or BRI’s.).</p>
<p>On clique sur <cite>Connectivity / DAHDI</cite></p>
<p><a class="reference external" href="https://wiki.freepbx.org/display/FPG/DAHDI+Configs">https://wiki.freepbx.org/display/FPG/DAHDI+Configs</a> pour plus de détails.</p>
</section>
<section id="comment-savoir-si-ma-telephony-card-est-bien-reconnue-par-le-freepbx">
<h2>Comment savoir si ma telephony card est bien reconnue par le FreePBX<a class="headerlink" href="#comment-savoir-si-ma-telephony-card-est-bien-reconnue-par-le-freepbx" title="Permalink to this headline">¶</a></h2>
<p># lspci
00:00.0 Host bridge: Intel Corporation Atom Processor Z36xxx/Z37xxx Series SoC Transaction Register (rev 11)
[…]
07:00.0 PCI bridge: PLX Technology, Inc. PEX8112 x1 Lane PCI Express-to-PCI Bridge (rev aa)
08:04.0 Network controller: Sangoma Technologies Corp. A200/Remora FXO/FXS Analog AFT card</p>
<p>Ma carte est bien reconnue par le BIOS.</p>
<p>FreePBX Wegui / Connectivity / DAHDI Configuration / Analog Hardware / il n’y a pas les port et pas d’action possible.</p>
<p><cite>issue https://issues.freepbx.org/browse/FREEPBX-7437</cite></p>
<p>The DAHDI module n’arrive pas à voir et à voir/configurer les A200 Sangoma card.</p>
<blockquote>
<div><p><a class="reference external" href="https://issues.freepbx.org/browse/FREEPBX-12867">https://issues.freepbx.org/browse/FREEPBX-12867</a></p>
<p>Il faut faire:</p>
<ul class="simple">
<li><p>Desactiver le DAHDI module avec : Admin / Module Admin / DAHDI Config / Action : Disable.</p></li>
</ul>
<p>Process / Confirm / Apply config
- Reboot
- Running “/usr/sbin/wancfg_dahdi” at the cli.
je répond aux nombreuese questions.</p>
</div></blockquote>
</section>
<section id="a200-detected-on-slot-4-bus-8">
<h2>A200 detected on slot:4 bus:8<a class="headerlink" href="#a200-detected-on-slot-4-bus-8" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Would you like to configure AFT-200 on slot:4 bus:8</dt><dd><ol class="arabic simple">
<li><p>YES</p></li>
<li><p>NO</p></li>
</ol>
</dd>
</dl>
<p>[1-2]:1</p>
<dl class="simple">
<dt>Would you like to enable hardware DTMF detection?</dt><dd><ol class="arabic simple">
<li><p>YES</p></li>
<li><p>NO</p></li>
</ol>
</dd>
</dl>
<p>[1-2, ENTER=’YES’]:</p>
<dl class="simple">
<dt>Would you like to enable hardware fax detection?</dt><dd><ol class="arabic simple">
<li><p>YES</p></li>
<li><p>NO</p></li>
</ol>
</dd>
</dl>
<p>[1-2, ENTER=’NO’]:</p>
<dl class="simple">
<dt>Which codec will be used?</dt><dd><ol class="arabic simple">
<li><p>MULAW - North America</p></li>
<li><p>ALAW - Europe</p></li>
</ol>
</dd>
</dl>
<p>[1-2]:2</p>
<dl class="simple">
<dt>Which Operation Mode will be used?</dt><dd><ol class="arabic simple">
<li><p>FCC</p></li>
<li><p>TBR21</p></li>
<li><p>AUSTRALIA</p></li>
</ol>
</dd>
</dl>
<p>[1-3, ENTER=’FCC’]:</p>
<p>Press any key to continue:
AFT-200 configured on slot:4 bus:8 span:1</p>
<p>Analog card configuration complete</p>
<p>Press any key to continue:
Dahdi and Wanpipe configuration complete: choose action</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Save cfg: Restart Asterisk &amp; Wanpipe now</p></li>
<li><p>Save cfg: Restart Asterisk &amp; Wanpipe when convenient</p></li>
<li><p>Save cfg: Stop Asterisk &amp; Wanpipe now</p></li>
<li><p>Save cfg: Stop Asterisk &amp; Wanpipe when convenient</p></li>
<li><p>Save cfg: Save cfg only (Not Recommended!!!)</p></li>
<li><p>Do not save cfg: Exit</p></li>
</ol>
</div></blockquote>
<p>[1-6]:1
Stopping Asterisk…</p>
<p>Removing old configuration files…</p>
<p>Copying new Wanpipe configuration files…</p>
<p>Copying new Dahdi configuration file (/etc/dahdi/system.conf)…</p>
<p>Copying new chan_dahdi configuration files (/etc/asterisk/chan_dahdi.conf)…</p>
<p>Starting Asterisk…</p>
<p>Listing Asterisk channels…</p>
<p>No such command ‘dahdi show channels’ (type ‘core show help dahdi’ for other possible commands)</p>
<p>Type “asterisk -r” to connect to Asterisk console</p>
<p>Wanrouter start complete…</p>
<dl class="simple">
<dt>Would you like to execute ‘dahdi_cfg’ each time wanrouter starts?</dt><dd><ol class="arabic simple">
<li><p>YES</p></li>
<li><p>NO</p></li>
</ol>
</dd>
</dl>
<p>[1-2]:1
Removing old smg_ctrl boot…..OK
Removing old smg_ctrl_safe boot…..OK
Sangoma cards configuration complete, exiting…</p>
<p>Reboot
Enable DAHDI config mdule
Reboot
Connectivity / DaHDI Config / FXO Port 1,2,3,4 ports c’est bon.</p>
<p># asterisk -r
CLI&gt; dahdi show status
Description                              Alarms  IRQ    bpviol CRC    Fra Codi Options  LBO
wrtdm Board 1                            OK      0      0      0      CAS Unk           0 db (CSU)/0-133 feet (DSX-1)</p>
<dl>
<dt>CLI&gt;  dahdi show channels</dt><dd><blockquote>
<div><p>Chan Extension       Context         Language   MOH Interpret        Blocked    In Service Description</p>
</div></blockquote>
<p>pseudo                 default                    default                         Yes</p>
<p>C’est pas tres bon signe.</p>
<p># DAHDI Configs module</p>
</dd>
</dl>
<p>Permet de configurer les DAHDI PSTN card (analog, T1/E1/PRI or BRI’s.).</p>
<p>On clique sur <cite>Connectivity / DAHDI</cite></p>
<p><a class="reference external" href="https://wiki.freepbx.org/display/FPG/DAHDI+Configs">https://wiki.freepbx.org/display/FPG/DAHDI+Configs</a> pour plus de détails.</p>
<blockquote>
<div><p><a class="reference external" href="https://uclord.wordpress.com/tag/sangoma-card/">ici</a>
-&gt; /etc/dahdi/system.conf</p>
</div></blockquote>
<p>-&gt; /etc/asterisk/chan_dahdi.conf  : contient les paramètres généraux du DAHDI channel.</p>
<blockquote>
<div><p>1 Stop asterisk
2 Restart wanpipe driver : # wanrouter restart
3 check physical layer : #wanpipemon -i w1g1 -c astats -m X (X = 1 , 2 , 3 , 4 les ports FXO)
On voit s’ils sont connectés à l’OPT.
4 Check that the Wanpipe network interface is processing data properly: ifconfig
[…]
w1g1: flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 8</p>
<blockquote>
<div><p>ppp  txqueuelen 100  (Point-to-Point Protocol)
RX packets 1968249  bytes 15745992 (15.0 MiB)
RX errors 0  dropped 0  overruns 8  frame 8
TX packets 1968249  bytes 15745992 (15.0 MiB)
TX errors 0  dropped 0 overruns 9  carrier 0  collisions 0
device interrupt 17  memory 0xffffbf45c0880000-ffffbf45c0881fff</p>
</div></blockquote>
<p>Ensure that Rx and Tx packets are increasing for the wanpipe interface.</p>
<p>5 Connectivity / DAHDI Channels DIDs:
Channel (-port de la carte sangoma)
Description blabla
DID : numero du fax par exemple.</p>
<dl class="simple">
<dt>dahdi show channels</dt><dd><p>Chan Extension       Context         Language   MOH Interpret        Blocked    In Service Description</p>
</dd>
</dl>
<p>pseudo                 default                    default                         Yes</p>
</div></blockquote>
</section>
<section id="dahdi-analog-channel-dids-module">
<h2>DAHDI (Analog) Channel DIDs module<a class="headerlink" href="#dahdi-analog-channel-dids-module" title="Permalink to this headline">¶</a></h2>
<p><cite>Connectivity / DAHDI Channel DIDs</cite></p>
<p>Ce module permet d’assigner un DID (un numero de téléphone) à un channel anlogique spécifique. Contrairement SIP ou PRI trunk, les lignes analogique n’envoie pas le DID ou le numero composé. Et nous avons besoin de mapper chaque port analogique ou channel a un numero fake comme cela nous pouvons matcher ce numero à une Inbound Route et router l’appel.</p>
<p>Il est possible de mapper sur le même numéro de téléphone plusieurs channels.
Une fois que l’on a assigné un DID, on peut utiliser les Inbound Route pour router l’appel.</p>
<p>Il <em>FAUT</em> que le <em>context</em> du channel soit à <em>from-analog</em> : <cite>context = from-analog</cite> in your chan_dahdi.conf. Cela se fait dans le DAHDI config module</p>
<section id="what-is-the-dahdi-channel-dids-module-used-for">
<h3>What is the DAHDI Channel DIDs module used for?<a class="headerlink" href="#what-is-the-dahdi-channel-dids-module-used-for" title="Permalink to this headline">¶</a></h3>
<p>The DAHDI Channel DIDs module allows you to assign a DID or phone number to specific analog channels.
Unlike SIP or PRI trunks, analog lines do not send a DID or dialed number to the PBX. Since the PBX routes all inbound calls based on the DID or number dialed, we need to map each analog port or channel to a fake number so we can match that number to an Inbound Route number and route your calls.
Each channel can be mapped to the same phone number if you want all calls on the analog lines to go to the same destination. This would be a common scenario if you have multiple POTS lines that are on a hunt group from your provider.
You MUST assign the channel’s context to from-analog for these settings to have effect. It will be a line that looks like: context = from-analog in your chan_dahdi.conf configuration affecting the specified channel(s). Once you have assigned DIDs, you can use standard Inbound Routes with the specified DIDs to route your calls.</p>
<p>Channel
The DAHDI Channel number to map to a DID. For example, If you have a 4-port card, your channels would be ports 1-4.</p>
</section>
<section id="comment-faire-pour-qu-une-ligne-pstn-soit-affectee-a-une-certaine-inbound-route">
<h3>Comment faire pour qu’une ligne pstn soit affectée à une certaine inbound route?<a class="headerlink" href="#comment-faire-pour-qu-une-ligne-pstn-soit-affectee-a-une-certaine-inbound-route" title="Permalink to this headline">¶</a></h3>
<p><cite>Connectivity - DAHDI Channel DIDs</cite> :
A chaque ports FXO on assigne un DID (un numero de téléphone fictif. On mettra celui de la ligne PSTN). On mappe ainsi les FXO à une ligne PSTN.
Car le fournisseur ne passe pas le DID dans les lignes analogiques.
Puis dans Inbound Route on utilise ce DID pour router l’appel.</p>
</section>
</section>
<section id="commment-savoir-sur-quel-port-de-ma-carte-sangoma-la-ligne-pots-est-branchee">
<h2>Commment savoir sur quel port de ma carte sangoma la ligne POTS est branchée?<a class="headerlink" href="#commment-savoir-sur-quel-port-de-ma-carte-sangoma-la-ligne-pots-est-branchee" title="Permalink to this headline">¶</a></h2>
<p># wanpipemon -i w1g1 -c astats -m X il faut changer X avec le numero du port.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Freenas Doc</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Recovery_with_usb_key.html">Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="Resetting-password.html">Resetting password</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Laurent FRANCOIS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/DAHDI_config.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>